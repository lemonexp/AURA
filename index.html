<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura V2</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: { 750: '#2d3748', 850: '#1a202c', 900: '#111827', 950: '#030712' },
                        aura: { 500: '#8b5cf6', 600: '#7c3aed' }, // Violet brand
                        accent: { 500: '#06b6d4', 600: '#0891b2' }, // Cyan accent
                        editor: { bg: '#1e1e1e', fg: '#d4d4d4', sidebar: '#252526', active: '#37373d' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Lexend Deca', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'scale-in': 'scaleIn 0.2s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        scaleIn: { '0%': { transform: 'scale(0.95)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } },
                    }
                }
            }
        }
    </script>
    
    <!-- Marked for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@600;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Pyodide for Python Execution -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #030712; color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Lexend Deca', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* Markdown Overrides */
        .prose p { margin-bottom: 0.75em; line-height: 1.6; }
        .prose pre { margin: 0.5em 0; border-radius: 0.5rem; background: #1f2937; padding: 1em; overflow-x: auto; border: 1px solid #374151; }
        .prose code { font-family: 'JetBrains Mono', monospace; background: rgba(255,255,255,0.1); padding: 0.1em 0.3em; border-radius: 0.25em; font-size: 0.9em; }
        .prose pre code { background: transparent; padding: 0; border: none; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .prose blockquote { border-left: 3px solid #8b5cf6; padding-left: 1em; font-style: italic; color: #9ca3af; margin: 1em 0; background: rgba(139, 92, 246, 0.05); padding-y: 0.5em; border-radius: 0 0.5rem 0.5rem 0; }
        .prose a { color: #a78bfa; text-decoration: none; border-bottom: 1px dotted #a78bfa; transition: color 0.2s; }
        .prose a:hover { color: #c4b5fd; border-bottom-style: solid; }
        
        /* Table Centering */
        .prose table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        .prose th, .prose td { border: 1px solid #374151; padding: 0.5em; text-align: center !important; }
        .prose th { background: #1f2937; }

        /* Math Spacing */
        .katex-display { margin: 2.5em 0 !important; overflow-x: auto; overflow-y: hidden; }

        /* Explicit Header Sizing */
        .prose h1 { font-size: 2.25rem; font-weight: 700; margin-top: 1.2em; margin-bottom: 0.6em; color: #f3f4f6; letter-spacing: -0.025em; }
        .prose h2 { font-size: 1.875rem; font-weight: 700; margin-top: 1.2em; margin-bottom: 0.6em; color: #e5e7eb; letter-spacing: -0.025em; }
        .prose h3 { font-size: 1.5rem; font-weight: 600; margin-top: 1.1em; margin-bottom: 0.5em; color: #d1d5db; }
        .prose h4 { font-size: 1.25rem; font-weight: 600; margin-top: 1em; margin-bottom: 0.5em; color: #9ca3af; }
        .prose strong { color: #fff; font-weight: 700; }
        .prose em { color: #e5e7eb; font-style: italic; }
        
        /* Glassmorphism Utilities */
        .glass-panel { background: rgba(17, 24, 39, 0.75); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-input { background: rgba(3, 7, 18, 0.6); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-button { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.2s; }
        .glass-button:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.1); }
        
        /* Editor Styles */
        .cm-editor { font-family: 'JetBrains Mono', monospace; line-height: 1.5; }
        .line-numbers { user-select: none; text-align: right; color: #6e7681; padding-right: 1rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect, useMemo } = React;

        // --- Icons (Inline SVGs) ---
        const Icons = {
            Send: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
            Paperclip: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>,
            Menu: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></svg>,
            Plus: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Trash2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Download: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Settings: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Lock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Zap: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Cpu: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><path d="M9 1v3"/><path d="M15 1v3"/><path d="M9 20v3"/><path d="M15 20v3"/><path d="M20 9h3"/><path d="M20 15h3"/><path d="M1 9h3"/><path d="M1 15h3"/></svg>,
            ShieldAlert: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            ChevronDown: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m6 9 6 6 6-6"/></svg>,
            Image: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            Video: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
            FileText: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            Wrench: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
            Eye: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Coffee: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" x2="6" y1="1" y2="4"/><line x1="10" x2="10" y1="1" y2="4"/><line x1="14" x2="14" y1="1" y2="4"/></svg>,
            Book: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Info: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            Grid: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="7" x="3" y="3" rx="1" /><rect width="7" height="7" x="14" y="3" rx="1" /><rect width="7" height="7" x="14" y="14" rx="1" /><rect width="7" height="7" x="3" y="14" rx="1" /></svg>,
            Code: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></svg>,
            Play: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="5 3 19 12 5 21 5 3" /></svg>,
            Terminal: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="4 17 10 11 4 5" /><line x1="12" x2="20" y1="19" y2="19" /></svg>,
            Layout: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>,
            
            // --- UPDATED: High-Quality Brand Icons (Paths) ---
            ReactLogo: (props) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="-11.5 -10.23174 23 20.46348" width="24" height="24" fill="none" {...props}><circle cx="0" cy="0" r="2.05" fill="#61dafb"/><g stroke="#61dafb" strokeWidth="1" fill="none"><ellipse rx="11" ry="4.2"/><ellipse rx="11" ry="4.2" transform="rotate(60)"/><ellipse rx="11" ry="4.2" transform="rotate(120)"/></g></svg>,
            PythonLogo: (props) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="24" height="24" {...props}><path fill="#3776ab" d="M63.07 10.99c-14.86.07-28.71 1.95-28.71 16.59v8.52h29.23v2.87H27.97C13.25 38.97 9.8 52.3 9.8 63.85c0 12.38 2.5 22.82 23.3 22.82h5.12V74.83c0-9.45 6.77-17.52 16.9-17.52h26.54c2.87 0 5.2-2.12 5.2-4.73V33.8c0-10.9-9.17-17.47-20.2-21.75-2.73-1.07-3.2-1.07-3.6-1.07zM42.27 23.95c3.08 0 5.58 2.52 5.58 5.61 0 3.1-2.5 5.62-5.58 5.62-3.09 0-5.6-2.52-5.6-5.62 0-3.09 2.51-5.61 5.6-5.61z"/><path fill="#ffd343" d="M98.88 38.97h-5.12v11.83c0 9.45-6.77 17.53-16.9 17.53H50.32c-2.87 0-5.2 2.12-5.2 4.73v18.77c0 10.9 9.17 17.47 20.2 21.75 2.73 1.07 3.2 1.07 3.6 1.07 14.86-.07 28.71-1.95 28.71-16.59v-8.52H68.4v-2.87h35.62c14.72 0 18.17-13.33 18.17-24.88 0-12.38-2.5-22.82-23.3-22.82zm-12.87 74.5c-3.09 0-5.6-2.52-5.6-5.62 0-3.09 2.51-5.61 5.6-5.61s5.58 2.52 5.58 5.61c0 3.1-2.5 5.62-5.58 5.62z"/></svg>,
            HtmlLogo: (props) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24" {...props}><path fill="#e34f26" d="M71 460L30 0h452l-41 460-185 52"/><path fill="#ef652a" d="M256 472l149-41 29-327H256"/><path fill="#ebebeb" d="M256 208H136l-5-56h125V80H80l13 147h163l-6 67-91 24-91-24-4-43H94l6 86 156 43 156-43 12-128H256z"/></svg>,
            CssLogo: (props) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24" {...props}><path fill="#1572b6" d="M30 0l41 460 185 52 185-52 41-460H30z"/><path fill="#33a9dc" d="M256 472l149-41 29-327H256v368z"/><path fill="#ebebeb" d="M256 208H136l-5-56h125V80H80l13 147h163l-6 67-91 24-91-24-4-43H94l6 86 156 43 156-43 12-128H256z"/></svg>,
            JsLogo: (props) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 630 630" width="24" height="24" {...props}><path fill="#f7df1e" d="M0 0h630v630H0z"/><path d="M423.2 492.19c12.69 20.72 29.2 35.13 58.4 35.13 24.53 0 40.2-12.26 40.2-29.2 0-20.3-17.12-27.49-43.1-39.3l-14.8-6.35c-42.72-19.05-71.1-41.02-71.1-89.2 0-44.4 33.83-78.2 86.6-78.2 37.64 0 64.7 13.1 84.2 47.4l-46.1 29.6c-10.15-18.2-21.1-25.4-38.1-25.4-17.3 0-28.3 10.5-28.3 25.4 0 18.2 16.1 24.9 40.6 36l13.5 6.36c50.3 24.1 77.4 50 77.4 92 0 53.3-33.4 81.9-91.4 81.9-52 0-87.2-22.8-100.4-56.4l42.4-29.7zM197.69 492.19c12.7 20.72 29.2 35.13 58.4 35.13 24.5 0 40.2-12.26 40.2-29.2 0-20.3-17.1-27.49-43.1-39.3l-14.8-6.35c-42.7-19.05-71.1-41.02-71.1-89.2 0-44.4 33.9-78.2 86.6-78.2 37.6 0 64.7 13.1 84.2 47.4l-46.1 29.6c-10.1-18.2-21.1-25.4-38.1-25.4-17.3 0-28.3 10.5-28.3 25.4 0 18.2 16.1 24.9 40.6 36l13.5 6.36c50.3 24.1 77.4 50 77.4 92 0 53.3-33.4 81.9-91.4 81.9-52 0-87.2-22.8-100.4-56.4l42.4-29.7z" fill="#000" opacity="0"/></svg>, // Simplified fallback
        };

        // --- Config & Prompt ---
        const DEFAULT_SYSTEM_PROMPT = `
You are Aura. Model: Aura 2.0 Modern.
Creators: TidalVoid, lemonexp, kosmos.
Tone: Helpful, witty, smart. Roast if the user is being silly.
Capabilities: Math, Code, Analysis, Image Vision.

*** AURA CANVAS & CODE EXECUTION ***
You have access to "Aura Canvas", a persistent split-screen coding environment.
- COMMAND: If the user says "/run" or asks to "run this code", "make a web app", or "execute this", you MUST trigger the internal runner.
- TRIGGER: To trigger the runner, output ONLY the code block. Do not add conversational text before or after.
- FORMAT:
  \`\`\`language_id
  ... code ...
  \`\`\`
- SUPPORTED LANGUAGES:
  - HTML/React: Use 'html' or 'react'. (It runs in a web preview with Tailwind & Babel).
  - Python: Use 'python'. (Runs in Pyodide. Supports numpy, matplotlib, standard lib. No terminal input).
  - JavaScript: Use 'js'.
- BEHAVIOR: When you output a single code block in response to a run request, the system automatically opens Canvas and runs it.
- CONTEXT: If the user closes Canvas, the code is saved. You can edit it by outputting a new block.

Formatting Requirements:
- STRUCTURE: Use Markdown.
- MATH: Always use $$ ... $$ for block math (centered) and $ ... $ for inline math.
- HEADINGS: Use ### for Main Headings (Large) and #### for Subheadings (Medium).
- EMPHASIS: Use **bold** for important terms and *italic* for subtle emphasis.
`;
        
        const DEFAULT_MEMORY_TEMPLATE = `[IDENTITY]:
[CONSTRAINTS]:
[PROJECTS]:
[STYLE]:`;

        const DEV_MODE_PASSKEY = "zoinkvoid70kimjongunramdoesstuff!";
        
        // Model Configuration
        const MODELS = {
            swift: { id: 'swift', name: 'Aura Swift', apiModel: 'gemini-2.5-flash-lite', desc: 'Fast', icon: Icons.Zap },
            nexus: { id: 'nexus', name: 'Aura Nexus', apiModel: 'gemini-3-flash-preview', desc: 'Capable', icon: Icons.Cpu },
        };

        const CODE_LANGUAGES = [
            { id: 'html', name: 'HTML', mode: 'web', icon: <Icons.HtmlLogo /> },
            { id: 'react', name: 'React', mode: 'web', icon: <Icons.ReactLogo /> },
            { id: 'js', name: 'JavaScript', mode: 'web', icon: <Icons.JsLogo /> },
            { id: 'css', name: 'CSS', mode: 'web', icon: <Icons.CssLogo /> },
            { id: 'python', name: 'Python', mode: 'py', icon: <Icons.PythonLogo /> },
        ];

        // --- Components ---
        
        const Icon = ({ icon: IconComponent, size = 20, className }) => {
            if (!IconComponent) return null;
            // Handle React Element passed as icon
            if (React.isValidElement(IconComponent)) {
                return React.cloneElement(IconComponent, { width: size, height: size, className });
            }
            return <IconComponent width={size} height={size} className={className} />;
        };

        const MarkdownRenderer = ({ content, isCollapsedDefault = false }) => {
            const containerRef = useRef(null);
            const [collapsed, setCollapsed] = useState(isCollapsedDefault);
            const [isLong, setIsLong] = useState(false);

            useEffect(() => {
                if (content && content.length > 800) setIsLong(true);
            }, [content]);

            useEffect(() => {
                if (containerRef.current && content) {
                    try {
                        const rawHtml = marked.parse(String(content));
                        containerRef.current.innerHTML = rawHtml;
                        if (window.renderMathInElement) {
                            renderMathInElement(containerRef.current, {
                                delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}],
                                throwOnError: false
                            });
                        }
                    } catch (e) {
                        containerRef.current.innerText = content;
                    }
                }
            }, [content]);

            return (
                <div className="relative">
                    <div 
                        ref={containerRef} 
                        className={`prose prose-invert max-w-none text-sm sm:text-base leading-relaxed break-words ${collapsed && isLong ? 'max-h-48 overflow-hidden mask-gradient-b' : ''}`} 
                    />
                    {isLong && (
                        <button 
                            onClick={() => setCollapsed(!collapsed)}
                            className="text-xs text-aura-400 hover:text-aura-300 mt-2 flex items-center gap-1 font-medium transition-colors"
                        >
                            {collapsed ? 'Show more' : 'Show less'} <Icon icon={Icons.ChevronDown} size={12} className={`transform transition-transform ${collapsed ? '' : 'rotate-180'}`} />
                        </button>
                    )}
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fade-in">
                    <div className="glass-panel bg-[#0f172a] rounded-2xl w-full max-w-md p-6 shadow-2xl relative max-h-[90vh] flex flex-col transform transition-all duration-300 border border-white/10">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                            <Icon icon={Icons.X} />
                        </button>
                        <h2 className="text-xl font-bold mb-4 text-aura-500 font-display flex-shrink-0">{title}</h2>
                        <div className="overflow-y-auto flex-1 custom-scrollbar pr-2">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- NEW: Aura Canvas Component (Redesigned & Persistent) ---
        const AuraCanvas = ({ isOpen, onClose, code, setCode, language, setLanguage }) => {
            // Note: We intentionally DO NOT return null here. 
            // We use CSS visibility to keep state (iframe, pyodide env) alive.

            const [isRunning, setIsRunning] = useState(false);
            const [activeTab, setActiveTab] = useState('preview');
            const iframeRef = useRef(null);
            const [pyodide, setPyodide] = useState(null);
            const [pyLogs, setPyLogs] = useState([]);
            const [pyLoading, setPyLoading] = useState(false);
            const [plotImg, setPlotImg] = useState(null);

            // Lazy Load Pyodide (Runs once and persists)
            useEffect(() => {
                if (!pyodide && window.loadPyodide) {
                    const initPy = async () => {
                        setPyLoading(true);
                        try {
                            const py = await window.loadPyodide();
                            await py.loadPackage("micropip");
                            const micropip = py.pyimport("micropip");
                            await micropip.install('matplotlib'); 
                            await micropip.install('numpy');
                            
                            // Redirect stdout
                            py.setStdout({ batched: (msg) => setPyLogs(prev => [...prev, msg]) });
                            setPyodide(py);
                        } catch (e) {
                            setPyLogs(prev => [...prev, "Error loading Python environment: " + e.message]);
                        } finally {
                            setPyLoading(false);
                        }
                    };
                    initPy();
                }
            }, [pyodide]);

            const runCode = async () => {
                setIsRunning(true);
                setPlotImg(null); // Clear previous plots
                const currentLang = CODE_LANGUAGES.find(l => l.id === language);

                if (currentLang.mode === 'web') {
                    setActiveTab('preview');
                    if (iframeRef.current) {
                        const doc = iframeRef.current.contentDocument || iframeRef.current.contentWindow.document;
                        doc.open();
                        
                        // Heuristic to detect content type
                        const isReact = language === 'react' || code.includes('react') || code.includes('className=') || code.includes('useState') || code.includes('export default');
                        const isPureJS = language === 'js' && !code.includes('html');
                        const isPureCSS = language === 'css';

                        let finalHTML = '';

                        if (isPureCSS) {
                            finalHTML = `<!DOCTYPE html><html><head><style>${code}</style></head><body><div class="p-10"><h1>CSS Preview</h1><p>Check the style application.</p></div></body></html>`;
                        } else if (isPureJS) {
                            finalHTML = `<!DOCTYPE html><html><body><script>${code}<\/script><div class="p-10"><h1>JS Running</h1><p>Check console logs.</p></div></body></html>`;
                        } else if (isReact) {
                             // Handle export default logic and cleanup code for embedding
                             let rawCode = code
                                .replace(/import\s+React.*?;/gi, '') // Remove React imports (already global)
                                .replace(/import\s+.*?from\s+['"].*?['"];/gi, '') // Remove other imports
                                .replace(/export\s+default\s+function\s+(\w+)/, 'function $1') // Handle "export default function App" -> "function App"
                                .replace(/export\s+default\s+(\w+);?/, ''); // Handle "export default App" at bottom

                             // Try to find the component name
                             let appName = 'App';
                             const fnMatch = rawCode.match(/function\s+(\w+)/);
                             const constMatch = rawCode.match(/const\s+(\w+)\s*=\s*\(/);
                             if (fnMatch) appName = fnMatch[1];
                             else if (constMatch) appName = constMatch[1];

                             // Create the mounting script
                             const scriptContent = `
                                const { useState, useEffect, useRef, useMemo, useCallback } = React;
                                try {
                                    ${rawCode}
                                    const root = ReactDOM.createRoot(document.getElementById('root')); 
                                    root.render(<${appName} />);
                                } catch (err) {
                                    document.body.innerHTML = '<div style="color:red; padding:20px; font-family:monospace">Runtime Error: ' + err.message + '</div>';
                                    console.error(err);
                                }
                             `;

                             finalHTML = `
                                <!DOCTYPE html>
                                <html>
                                <head>
                                    <meta charset="UTF-8" />
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                                    
                                    <!-- Added Standard React/JS Libs -->
                                    <script src="https://unpkg.com/react@18/umd/react.production.min.js"><\/script>
                                    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"><\/script>
                                    <script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>
                                    <script src="https://cdn.tailwindcss.com"><\/script>
                                    
                                    <!-- Extras: Lodash, Axios, Framer Motion, Lucide -->
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"><\/script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"><\/script>
                                    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"><\/script>
                                    <script src="https://unpkg.com/lucide@latest"><\/script>
                                    <script src="https://unpkg.com/lucide-react@latest"><\/script>

                                    <style>body { background-color: white; color: black; }</style>
                                </head>
                                <body>
                                    <div id="root"></div>
                                    <script type="text/babel">
                                        // Error Boundary for compilation errors
                                        window.onerror = function(message, source, lineno, colno, error) {
                                            document.body.innerHTML = '<div style="color:red; padding:20px; font-family:monospace">Preview Error: ' + message + '</div>';
                                        };
                                        ${scriptContent}
                                    <\/script>
                                </body>
                                </html>
                            `;
                        } else {
                            finalHTML = code;
                        }

                        doc.write(finalHTML);
                        doc.close();
                    }
                } else if (currentLang.mode === 'py') {
                    setActiveTab('console');
                    setPyLogs([]);
                    if (!pyodide) {
                        setPyLogs(["Waiting for Python environment..."]);
                    } else {
                        try {
                            await pyodide.loadPackagesFromImports(code);
                            await pyodide.runPythonAsync(`
import matplotlib.pyplot as plt
import io, base64
def show_plot():
    buf = io.BytesIO()
    plt.savefig(buf, format='png')
    buf.seek(0)
    return base64.b64encode(buf.read()).decode('utf-8')
plt.show = show_plot
                            `);
                            const result = await pyodide.runPythonAsync(code);
                            try {
                                const plotB64 = await pyodide.runPythonAsync("plt.show()");
                                if(plotB64 && plotB64.length > 100) setPlotImg(`data:image/png;base64,${plotB64}`);
                            } catch(e) {}

                        } catch (err) {
                            let msg = err.message;
                            if (msg.includes("curses") || msg.includes("ModuleNotFoundError")) {
                                msg += "\n\nðŸ’¡ Note: Browser-based Python (Pyodide) cannot run terminal-native libraries like 'curses', 'pygame', or 'tkinter'. Use standard print() output or matplotlib for graphs.";
                            }
                            setPyLogs(prev => [...prev, `Error: ${msg}`]);
                        }
                    }
                }
                setTimeout(() => setIsRunning(false), 500);
            };

            const switchLang = (id) => {
                setLanguage(id);
                if(code.trim().length < 50) { // Only reset if code is basically empty
                    if(id === 'python') setCode('import numpy as np\nprint("Running Python...")\n\n# Example\narr = np.array([1, 2, 3])\nprint(f"Array: {arr}")');
                    else if (id === 'html') setCode(`<!-- Web App -->\n<div class="flex h-screen items-center justify-center bg-gray-50">\n  <h1 className="text-4xl font-bold text-blue-600">Hello HTML</h1>\n</div>`);
                    else if (id === 'react') setCode(`// React Component\nfunction App() {\n  return (\n    <div className="flex h-screen items-center justify-center bg-gray-900 text-white">\n      <h1 className="text-4xl font-bold text-purple-500">Hello React</h1>\n    </div>\n  );\n}\nexport default App;`);
                }
            };

            return (
                <div className={`fixed inset-0 z-[100] bg-[#1e1e1e] flex flex-col text-gray-300 font-sans transition-all duration-300 ${isOpen ? 'opacity-100 pointer-events-auto scale-100' : 'opacity-0 pointer-events-none scale-95 pointer-events-none'}`} style={{ visibility: isOpen ? 'visible' : 'hidden' }}>
                    {/* Top Bar */}
                    <div className="h-12 bg-[#252526] flex items-center justify-between px-4 border-b border-black">
                        <div className="flex items-center gap-4">
                            <Icon icon={Icons.Code} className="text-blue-400" />
                            <span className="font-bold text-xs uppercase tracking-wider text-gray-400">Aura Canvas</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <button onClick={runCode} className="flex items-center gap-2 px-3 py-1 bg-green-700 hover:bg-green-600 text-white text-xs font-bold rounded transition-colors">
                                <Icon icon={Icons.Play} size={12} /> {isRunning ? 'Running' : 'Run Code'}
                            </button>
                            <button onClick={onClose} className="hover:text-white"><Icon icon={Icons.X} size={18} /></button>
                        </div>
                    </div>

                    <div className="flex-1 flex overflow-hidden">
                        {/* Sidebar */}
                        <div className="w-32 bg-[#252526] flex flex-col py-4 gap-2 border-r border-black overflow-y-auto">
                            {CODE_LANGUAGES.map(l => (
                                <button 
                                    key={l.id} 
                                    onClick={() => switchLang(l.id)} 
                                    className={`w-full px-4 py-3 flex items-center gap-3 transition-all ${language === l.id ? 'bg-[#37373d] text-white border-l-2 border-blue-500' : 'text-gray-500 hover:bg-[#2a2d2e]'}`}
                                    title={l.name}
                                >
                                    <span className="text-lg">{l.icon}</span>
                                    <span className="text-[10px] font-bold uppercase tracking-wider">{l.name}</span>
                                </button>
                            ))}
                        </div>

                        {/* Editor Area */}
                        <div className="flex-1 flex flex-col md:flex-row">
                            {/* Input */}
                            <div className="flex-1 flex flex-col bg-[#1e1e1e] border-r border-black relative group">
                                <div className="absolute left-0 top-0 bottom-0 w-12 bg-[#1e1e1e] border-r border-[#2b2b2b] text-right text-gray-600 font-mono text-xs pt-4 pr-2 select-none pointer-events-none hidden md:block">
                                    {code.split('\n').map((_, i) => <div key={i}>{i+1}</div>)}
                                </div>
                                <textarea 
                                    value={code}
                                    onChange={(e) => setCode(e.target.value)}
                                    className="flex-1 bg-transparent p-4 md:pl-16 font-mono text-sm text-[#d4d4d4] outline-none resize-none leading-relaxed selection:bg-blue-500/30"
                                    spellCheck="false"
                                />
                            </div>

                            {/* Output Panel */}
                            <div className="flex-1 flex flex-col bg-[#1e1e1e] border-t md:border-t-0 md:border-l border-black h-1/2 md:h-auto">
                                <div className="h-9 bg-[#252526] flex items-center px-4 border-b border-black gap-4">
                                    <button onClick={() => setActiveTab('preview')} className={`text-xs font-bold uppercase py-2 border-b-2 transition-colors ${activeTab === 'preview' ? 'border-blue-500 text-white' : 'border-transparent text-gray-500'}`}>Preview</button>
                                    <button onClick={() => setActiveTab('console')} className={`text-xs font-bold uppercase py-2 border-b-2 transition-colors ${activeTab === 'console' ? 'border-blue-500 text-white' : 'border-transparent text-gray-500'}`}>Terminal</button>
                                </div>
                                <div className="flex-1 relative bg-black">
                                    <div className={`absolute inset-0 ${activeTab === 'preview' ? 'block' : 'hidden'} bg-white`}>
                                        <iframe ref={iframeRef} className="w-full h-full border-none" title="preview" />
                                    </div>
                                    <div className={`absolute inset-0 p-4 font-mono text-xs overflow-auto ${activeTab === 'console' ? 'block' : 'hidden'}`}>
                                        <div className="text-gray-500 mb-2">$ aura run {language}</div>
                                        {pyLoading && <div className="text-yellow-500">Initializing Environment (Loading Libs)...</div>}
                                        {language === 'python' ? (
                                            <>
                                                {pyLogs.map((log, i) => <div key={i} className="text-green-400 mb-1 whitespace-pre-wrap">{log}</div>)}
                                                {plotImg && <img src={plotImg} className="mt-4 border border-white/20 rounded max-w-full" alt="Plot" />}
                                            </>
                                        ) : (
                                            pyLogs.map((log, i) => <div key={i} className="text-gray-300 mb-1">{log}</div>)
                                        )}
                                        {activeTab === 'console' && language !== 'python' && pyLogs.length === 0 && <div className="text-gray-600 italic">Ready to run.</div>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [currentModel, setCurrentModel] = useState('swift');
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [apiKey, setApiKey] = useState('');
            const [storageMode, setStorageMode] = useState('local');
            const [userName, setUserName] = useState(localStorage.getItem('aura_username') || '');
            const [savedChats, setSavedChats] = useState([]);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [currentChatId, setCurrentChatId] = useState(Date.now().toString());
            const [showCoffee, setShowCoffee] = useState(true); 
            
            // Memory
            const [memoryContent, setMemoryContent] = useState(localStorage.getItem('aura_memory') || DEFAULT_MEMORY_TEMPLATE);
            const [isMemoryEnabled, setIsMemoryEnabled] = useState(true);
            const [showMemoryModal, setShowMemoryModal] = useState(false);
            const [showMemoryHelp, setShowMemoryHelp] = useState(false); 

            // Tools - Canvas State LIFTED to App for Persistence
            const [showToolsMenu, setShowToolsMenu] = useState(false);
            const [showCanvas, setShowCanvas] = useState(false);
            const [canvasCode, setCanvasCode] = useState(`<!-- Welcome to Aura Canvas -->\n<div class="p-10">\n  <h1 class="text-3xl font-bold text-aura-500">Ready to Code</h1>\n</div>`);
            const [canvasLang, setCanvasLang] = useState('html');

            // Renaming
            const [editingChatId, setEditingChatId] = useState(null);
            const [editingName, setEditingName] = useState('');

            // Dev Mode
            const [devMode, setDevMode] = useState(false);
            const [systemPrompt, setSystemPrompt] = useState(DEFAULT_SYSTEM_PROMPT);
            const [passkeyInput, setPasskeyInput] = useState('');
            
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showPasskeyModal, setShowPasskeyModal] = useState(false);
            const [imageModalSrc, setImageModalSrc] = useState(null);
            const [fileContentModal, setFileContentModal] = useState(null); 

            const messagesEndRef = useRef(null);
            const fileInputRef = useRef(null);
            const toolsMenuRef = useRef(null);

            // --- Init & Effects ---
            useEffect(() => {
                const storedChats = localStorage.getItem('aura_saved_chats');
                if (storedChats) setSavedChats(JSON.parse(storedChats));
                const storedKey = localStorage.getItem('aura_api_key');
                const storedMode = localStorage.getItem('aura_storage_mode');
                if (storedMode === 'local' && storedKey) { setApiKey(storedKey); setStorageMode('local'); } else setShowSettingsModal(true);
            }, []);

            useEffect(() => {
                if (messages.length > 0) {
                    setSavedChats(prev => {
                        const existingIndex = prev.findIndex(c => c.id === currentChatId);
                        const chatName = messages[0].text.substring(0, 30) || "New Chat";
                        const updatedChat = { id: currentChatId, name: chatName, messages: messages, timestamp: Date.now(), model: currentModel };
                        if (existingIndex >= 0) { const newChats = [...prev]; newChats[existingIndex] = updatedChat; return newChats; } 
                        else return [updatedChat, ...prev];
                    });
                }
            }, [messages, currentChatId]); 

            useEffect(() => {
                if (storageMode === 'local') { localStorage.setItem('aura_api_key', apiKey); localStorage.setItem('aura_storage_mode', 'local'); } 
                else if (storageMode === 'session') { localStorage.removeItem('aura_api_key'); localStorage.removeItem('aura_storage_mode'); }
            }, [apiKey, storageMode]);

            useEffect(() => { localStorage.setItem('aura_username', userName); }, [userName]);
            useEffect(() => { localStorage.setItem('aura_saved_chats', JSON.stringify(savedChats)); }, [savedChats]);
            useEffect(() => { localStorage.setItem('aura_memory', memoryContent); }, [memoryContent]);
            
            useEffect(() => {
                const handleClickOutside = (event) => { if (toolsMenuRef.current && !toolsMenuRef.current.contains(event.target)) setShowToolsMenu(false); };
                document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            useLayoutEffect(() => messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }), [messages, isLoading]);

            // --- Handlers ---
            const startNewChat = () => { setMessages([]); setCurrentChatId(Date.now().toString()); setSidebarOpen(false); };
            const loadChat = (chat) => { if (editingChatId) return; setMessages(chat.messages); setCurrentChatId(chat.id); setCurrentModel(chat.model || 'swift'); setSidebarOpen(false); };
            const toggleDevMode = () => { if (devMode) setDevMode(false); else { setPasskeyInput(''); setShowPasskeyModal(true); } };
            const submitPasskey = () => { if (passkeyInput === DEV_MODE_PASSKEY) { setDevMode(true); setShowPasskeyModal(false); setShowSettingsModal(true); } else alert("Incorrect Passkey."); };
            const handleRenameStart = (e, chat) => { e.preventDefault(); setEditingChatId(chat.id); setEditingName(chat.name); };
            const handleRenameSave = () => { if (!editingChatId) return; if (!editingName.trim()) { setEditingChatId(null); return; } setSavedChats(prev => prev.map(c => c.id === editingChatId ? { ...c, name: editingName } : c)); setEditingChatId(null); setEditingName(''); };

            const handleSendMessage = async (customText = null) => {
                if (isLoading) return; 
                const textToSend = customText || input;
                if (!textToSend.trim() && !uploadedFile) return;
                if (!apiKey) { setShowSettingsModal(true); return; }

                // Check for "Run" Intent
                const isRunRequest = textToSend.toLowerCase().startsWith('/run') || textToSend.toLowerCase().includes('run code') || textToSend.toLowerCase().includes('execute');

                const forbidden = ["ignore previous", "system prompt", "jailbreak"];
                if (forbidden.some(f => textToSend.toLowerCase().includes(f))) setMessages(prev => [...prev, { role: 'system', text: "âš ï¸ **Security Alert:** Possible prompt injection detected." }]);

                const userMsg = { role: 'user', text: textToSend, file: uploadedFile, timestamp: Date.now() };
                setMessages(prev => [...prev, userMsg]); setInput(''); setUploadedFile(null); setIsLoading(true);

                const history = messages.filter(m => m.role !== 'system').map(m => {
                    const parts = [{ text: m.text }];
                    if (m.file) {
                        if (m.file.type.startsWith('image')) parts.push({ inlineData: { mimeType: m.file.type, data: m.file.base64.split(',')[1] } });
                        else parts[0].text = `[File: ${m.file.name}]\n${m.file.content || '(Binary File)'}\n\n${m.text}`;
                    }
                    return { role: m.role === 'user' ? 'user' : 'model', parts };
                });

                const currentParts = [{ text: userMsg.text }];
                if (userMsg.file) {
                    if(userMsg.file.type.startsWith('image')) currentParts.push({ inlineData: { mimeType: userMsg.file.type, data: userMsg.file.base64.split(',')[1] } });
                    else if (userMsg.file.type.startsWith('text') || userMsg.file.name.endsWith('.js') || userMsg.file.name.endsWith('.py')) currentParts[0].text = `[File: ${userMsg.file.name}]\n${userMsg.file.content}\n\n${userMsg.text}`;
                    else currentParts[0].text = `[Attached Media: ${userMsg.file.name}]\n\n${userMsg.text}`;
                }
                history.push({ role: 'user', parts: currentParts });

                let finalSystemInstruction = systemPrompt;
                if (isMemoryEnabled && memoryContent.trim()) finalSystemInstruction = `[MEMORY - PREFERENCES & CONTEXT]\n${memoryContent}\n\n[SYSTEM INSTRUCTIONS]\n${systemPrompt}`;
                
                // INJECT "INTERNAL RUN" INSTRUCTION if detected
                if (isRunRequest) {
                    finalSystemInstruction += `\n\n[CRITICAL INSTRUCTION]: The user wants to run code. Output ONLY the raw code inside a markdown block (e.g., \`\`\`python ... \`\`\`). Do NOT output any conversational text, explanations, or filler. Just the code.`;
                }

                try {
                    const apiModelId = MODELS[currentModel].apiModel;
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${apiModelId}:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: history, systemInstruction: { parts: [{ text: finalSystemInstruction }] } })
                    });
                    if (!response.ok) throw new Error((await response.json()).error?.message || response.statusText);
                    const data = await response.json();
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
                    
                    // Internal Run Logic
                    const codeBlockMatch = aiText.match(/```(\w+)?\n([\s\S]*?)```/);
                    if (isRunRequest && codeBlockMatch) {
                        const lang = codeBlockMatch[1] || 'html';
                        const cleanCode = codeBlockMatch[2];
                        let mappedLang = lang;
                        if (lang === 'js' || lang === 'javascript') mappedLang = 'js';
                        if (lang === 'jsx' || lang === 'tsx') mappedLang = 'react';
                        
                        setCanvasLang(mappedLang);
                        setCanvasCode(cleanCode);
                        setShowCanvas(true);
                    } else {
                        setMessages(prev => [...prev, { role: 'model', text: aiText, timestamp: Date.now() }]);
                    }

                } catch (error) { setMessages(prev => [...prev, { role: 'model', text: `**Error:** ${error.message}`, isError: true }]); } finally { setIsLoading(false); }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const isImage = file.type.startsWith('image/'); const isVideo = file.type.startsWith('video/'); const isText = file.type.startsWith('text/') || ['.js','.py','.html','.css','.json','.md','.txt'].some(ext => file.name.endsWith(ext));
                    let fileObj = { name: file.name, type: file.type, base64: ev.target.result, isImage, isVideo, isText };
                    if (isText) { const textReader = new FileReader(); textReader.onload = (te) => { fileObj.content = te.target.result; setUploadedFile(fileObj); }; textReader.readAsText(file); } else setUploadedFile(fileObj);
                }; reader.readAsDataURL(file); e.target.value = null;
            };

            const handleAction = (action, text) => {
                if (action === 'copy') navigator.clipboard.writeText(text); if (action === 'continue') handleSendMessage("Please continue."); if (action === 'simple') handleSendMessage("Explain that simply.");
            };

            const renderMessage = (msg, index) => {
                const isUser = msg.role === 'user';
                return (
                    <div key={index} className={`flex gap-3 sm:gap-4 ${isUser ? 'justify-end' : 'justify-start'} animate-fade-in group mb-6 relative`}>
                        {!isUser && <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-aura-500 to-indigo-600 flex-shrink-0 flex items-center justify-center text-xs font-bold shadow-lg shadow-aura-500/20 mt-1">A</div>}
                        <div className={`max-w-[88%] lg:max-w-[70%] flex flex-col ${isUser ? 'items-end' : 'items-start'}`}>
                             {msg.file && (
                                <div className="mb-2 bg-gray-800/60 border border-gray-700/50 rounded-xl p-2.5 flex items-center gap-3 text-xs text-gray-300 max-w-full backdrop-blur-md">
                                    <div className="bg-gray-700/50 p-2 rounded-lg"><Icon icon={msg.file.isImage ? Icons.Image : msg.file.isVideo ? Icons.Video : Icons.FileText} size={16} className="text-aura-400" /></div>
                                    <div className="flex-1 min-w-0"><p className="truncate font-medium">{msg.file.name}</p></div>
                                    <div className="flex items-center gap-2">
                                        {msg.file.isImage && <img src={msg.file.base64} className="h-10 w-10 rounded-lg object-cover border border-gray-700 cursor-zoom-in" onClick={() => setImageModalSrc(msg.file.base64)} />}
                                        <button onClick={() => msg.file.isImage ? setImageModalSrc(msg.file.base64) : setFileContentModal(msg.file)} className="p-1.5 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition-colors"><Icon icon={Icons.Eye} size={16} /></button>
                                    </div>
                                </div>
                             )}
                            <div className={`relative px-4 py-3 sm:px-5 sm:py-4 rounded-2xl shadow-sm text-sm sm:text-base transition-all duration-200 ${isUser ? 'bg-gradient-to-br from-aura-600 to-indigo-600 text-white rounded-br-sm shadow-aura-500/10' : 'glass-panel text-gray-100 rounded-tl-sm hover:shadow-lg hover:shadow-black/20'}`}>
                                <MarkdownRenderer content={msg.text} />
                            </div>
                            {!isUser && !msg.isError && (
                                <div className="flex gap-2 mt-1.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 px-1">
                                    {['Copy', 'Continue', 'Simple'].map(action => (<button key={action} onClick={() => handleAction(action.toLowerCase(), msg.text)} className="text-[10px] text-gray-500 hover:text-aura-400 transition-colors uppercase font-bold tracking-wider">{action}</button>))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex h-screen bg-gray-950 text-gray-100 font-sans selection:bg-aura-500/30 overflow-hidden">
                    {/* Sidebar */}
                    <div className={`fixed inset-0 bg-black/80 z-40 lg:hidden transition-opacity duration-300 backdrop-blur-sm ${sidebarOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={() => setSidebarOpen(false)} />
                    <aside className={`fixed top-0 left-0 h-full w-72 glass-panel border-r-0 border-r-white/5 z-50 transform transition-transform duration-300 lg:relative lg:translate-x-0 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                         <div className="p-5 flex flex-col h-full">
                            <button onClick={startNewChat} className="w-full py-3.5 bg-gradient-to-r from-aura-600 to-indigo-600 hover:from-aura-500 hover:to-indigo-500 text-white rounded-xl font-bold shadow-lg shadow-aura-600/20 flex items-center justify-center gap-2 mb-8 transition-all hover:scale-[1.02] active:scale-[0.98]"><Icon icon={Icons.Plus} size={18} /> New Chat</button>
                            <div className="flex-1 overflow-y-auto space-y-2 mobile-hide-scrollbar pr-1">
                                <h3 className="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 pl-2">Recent History</h3>
                                {savedChats.map((c, i) => (
                                    <div key={c.id} onContextMenu={(e) => handleRenameStart(e, c)}>
                                        {editingChatId === c.id ? (<input autoFocus value={editingName} onChange={(e) => setEditingName(e.target.value)} onBlur={handleRenameSave} onKeyDown={(e) => e.key === 'Enter' && handleRenameSave()} className="w-full bg-black/40 text-white text-sm p-2 rounded border border-aura-500 outline-none mb-1" />) : (<div onClick={() => loadChat(c)} className={`p-3 rounded-lg hover:bg-white/5 cursor-pointer text-sm truncate transition-colors border border-transparent hover:border-white/5 ${currentChatId === c.id ? 'bg-white/10 text-white font-medium border-white/10' : 'text-gray-400'}`}>{c.name}</div>)}
                                    </div>
                                ))}
                            </div>
                            <div className="mt-auto pt-4 border-t border-white/10 flex flex-col gap-3">
                                {showCoffee && (<div className="relative group"><button onClick={() => window.open("https://buymeacoffee.com/", "_blank")} className="w-full py-2 bg-[#FFDD00] hover:bg-[#FFDD00]/90 text-black rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-colors shadow-lg shadow-yellow-500/10"><Icon icon={Icons.Coffee} size={16} /> Buy Me a Coffee</button><button onClick={(e) => { e.stopPropagation(); setShowCoffee(false); }} className="absolute -top-2 -right-2 bg-gray-800 text-gray-400 hover:text-white p-1 rounded-full border border-white/10 opacity-0 group-hover:opacity-100 transition-opacity"><Icon icon={Icons.X} size={10} /></button></div>)}
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3"><div className="w-8 h-8 rounded-full bg-gradient-to-tr from-gray-700 to-gray-600 flex items-center justify-center text-xs font-bold text-white shadow-inner">{userName ? userName[0] : 'U'}</div><span className="text-sm font-medium text-gray-300">{userName || 'User'}</span></div>
                                    <button onClick={() => setShowSettingsModal(true)} className="p-2 text-gray-500 hover:text-white hover:bg-white/10 rounded-lg transition-colors"><Icon icon={Icons.Settings} size={18} /></button>
                                </div>
                            </div>
                         </div>
                    </aside>

                    <main className="flex-1 flex flex-col min-w-0 relative bg-[#030712]">
                        <header className="h-16 border-b border-white/5 bg-gray-950/80 backdrop-blur-xl flex items-center justify-between px-6 sticky top-0 z-30">
                            <div className="flex items-center gap-4">
                                <button onClick={() => setSidebarOpen(true)} className="lg:hidden text-gray-400 hover:text-white"><Icon icon={Icons.Menu} /></button>
                                <div className="flex items-center gap-3"><img src="img.png" alt="Logo" className="h-8 w-8 object-contain" onError={(e) => e.target.style.display = 'none'} /><h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-aura-500 via-indigo-400 to-cyan-400 tracking-tight">Aura V2</h1></div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="flex bg-gray-900/80 p-1 rounded-lg border border-white/10">
                                    {Object.values(MODELS).map(m => (<button key={m.id} onClick={() => setCurrentModel(m.id)} className={`px-3 py-1.5 rounded-md text-xs font-medium flex items-center gap-2 transition-all ${currentModel === m.id ? 'bg-gray-800 text-white shadow-sm border border-white/5' : 'text-gray-500 hover:text-gray-300'}`}><Icon icon={m.icon} size={14} /><span className="hidden sm:inline">{m.name.replace('Aura ', '')}</span></button>))}
                                </div>
                                <button onClick={toggleDevMode} className={`p-2 rounded-lg transition-all ${devMode ? 'text-aura-400 bg-aura-500/10' : 'text-gray-500 hover:text-gray-300 hover:bg-white/5'}`} title="Developer Mode"><Icon icon={Icons.Wrench} size={18} /></button>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 sm:p-6 pb-60 scroll-smooth mobile-hide-scrollbar">
                            {messages.length === 0 && (
                                <div className="h-full flex flex-col items-center justify-center text-center p-8 opacity-0 animate-fade-in" style={{animationDelay: '0.1s', opacity: 1}}>
                                    <div className="w-24 h-24 rounded-3xl bg-gradient-to-tr from-aura-600/20 to-indigo-600/20 mb-8 shadow-2xl shadow-aura-500/10 flex items-center justify-center border border-white/5 backdrop-blur-md"><Icon icon={Icons.Zap} size={48} className="text-aura-400 drop-shadow-[0_0_15px_rgba(139,92,246,0.5)]" /></div>
                                    <h2 className="text-3xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-500">Welcome to Aura V2</h2>
                                    <p className="text-gray-500 text-sm max-w-sm leading-relaxed">Your advanced AI workspace. Secure, powerful, and designed for speed.</p>
                                </div>
                            )}
                            {messages.map(renderMessage)}
                            {isLoading && (<div className="flex gap-3 animate-fade-in pl-2"><div className="w-8 h-8 rounded-lg bg-gray-900/50 border border-white/5 flex items-center justify-center"><div className="w-1.5 h-1.5 bg-aura-500 rounded-full animate-pulse" /></div></div>)}
                            <div ref={messagesEndRef} className="h-24 w-full block" />
                        </div>

                        <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-[#030712] via-[#030712] to-transparent z-20">
                            <div className="max-w-3xl mx-auto flex flex-col gap-3">
                                <div className="glass-input rounded-2xl p-2 shadow-2xl relative border border-white/10 group focus-within:border-aura-500/50 transition-colors">
                                    {uploadedFile && (
                                        <div className="absolute -top-16 left-0 bg-gray-900/95 border border-white/10 rounded-xl p-2 flex items-center gap-3 text-xs shadow-xl animate-scale-in backdrop-blur-md z-30">
                                            {uploadedFile.isImage ? <img src={uploadedFile.base64} className="w-10 h-10 rounded object-cover cursor-pointer" onClick={() => setImageModalSrc(uploadedFile.base64)} /> : <div className="bg-gray-800 p-2 rounded-lg"><Icon icon={uploadedFile.isVideo ? Icons.Video : Icons.FileText} size={20} className="text-aura-400" /></div>}
                                            <div className="flex flex-col"><span className="max-w-[150px] truncate font-medium">{uploadedFile.name}</span><span className="text-[10px] text-gray-500 uppercase">Ready to send</span></div>
                                            <button onClick={() => setUploadedFile(null)} className="hover:text-red-400 ml-2"><Icon icon={Icons.X} size={14} /></button>
                                        </div>
                                    )}
                                    <div className="flex items-center gap-2 relative" ref={toolsMenuRef}>
                                        <div className="relative">
                                            <button onClick={() => setShowToolsMenu(!showToolsMenu)} className={`p-3 rounded-xl transition-colors ${showToolsMenu ? 'text-aura-400 bg-aura-500/10' : 'text-gray-500 hover:bg-white/5'}`} title="Aura Tools"><Icon icon={Icons.Grid} size={20} /></button>
                                            {showToolsMenu && (
                                                <div className="absolute bottom-12 left-0 w-56 bg-[#1e1e1e] border border-white/10 rounded-xl shadow-2xl overflow-hidden animate-scale-in flex flex-col py-1 z-50">
                                                    <div className="px-3 py-2 text-[10px] font-bold text-gray-500 uppercase tracking-widest border-b border-white/5 bg-black/20">Aura Tools</div>
                                                    <button onClick={() => { setShowMemoryModal(true); setShowToolsMenu(false); }} className="flex items-center gap-3 px-4 py-3 hover:bg-white/5 text-left transition-colors text-sm text-gray-200"><Icon icon={Icons.Book} size={16} className="text-indigo-400" /><div><div className="font-medium">Notebook</div><div className="text-[10px] text-gray-500">Memory & Context</div></div></button>
                                                    <button onClick={() => { setShowCanvas(true); setShowToolsMenu(false); }} className="flex items-center gap-3 px-4 py-3 hover:bg-white/5 text-left transition-colors text-sm text-gray-200"><Icon icon={Icons.Code} size={16} className="text-green-400" /><div><div className="font-medium">Canvas</div><div className="text-[10px] text-gray-500">Code Studio & Runner</div></div></button>
                                                </div>
                                            )}
                                        </div>
                                        <button onClick={() => fileInputRef.current.click()} className="p-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition-colors"><Icon icon={Icons.Plus} size={20} /></button>
                                        <input type="file" ref={fileInputRef} className="hidden" onChange={handleFileUpload} accept="image/*,video/*,text/*,.pdf,.js,.py,.html,.css,.json" />
                                        <textarea value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!isLoading) handleSendMessage(); } }} placeholder="Ask anything..." className="flex-1 bg-transparent border-none outline-none text-gray-100 placeholder-gray-600 resize-none py-3.5 max-h-32 min-h-[48px] text-sm sm:text-base" rows={1} onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }} />
                                        <button onClick={() => handleSendMessage()} disabled={isLoading || (!input.trim() && !uploadedFile)} className={`p-3 rounded-xl transition-all duration-300 ${input.trim() || uploadedFile ? 'bg-gradient-to-r from-aura-600 to-indigo-600 text-white shadow-lg shadow-aura-600/20 scale-100' : 'bg-gray-800/50 text-gray-600 scale-95'}`}><Icon icon={Icons.Send} size={20} /></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    <AuraCanvas isOpen={showCanvas} onClose={() => setShowCanvas(false)} code={canvasCode} setCode={setCanvasCode} language={canvasLang} setLanguage={setCanvasLang} />

                    <Modal isOpen={showMemoryModal} onClose={() => setShowMemoryModal(false)} title="Aura Notebook">
                        <div className="space-y-4">
                            <div className="bg-indigo-900/20 p-4 rounded-xl border border-indigo-500/20 mb-4">
                                <p className="text-xs text-indigo-300 mb-2 font-medium"><Icon icon={Icons.Book} size={14} className="inline mr-1"/> Memory is injected at the start of every chat.</p>
                                <div className="flex items-center justify-between"><span className="text-sm text-gray-300">Enable for this turn?</span><button onClick={() => setIsMemoryEnabled(!isMemoryEnabled)} className={`w-12 h-6 rounded-full transition-colors relative ${isMemoryEnabled ? 'bg-aura-600' : 'bg-gray-700'}`}><div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${isMemoryEnabled ? 'left-7' : 'left-1'}`} /></button></div>
                            </div>
                            <textarea value={memoryContent} onChange={(e) => setMemoryContent(e.target.value)} className="w-full h-64 bg-black/30 border border-white/10 rounded-xl p-4 text-sm font-mono text-gray-300 resize-none outline-none focus:border-aura-500 leading-relaxed" placeholder="[IDENTITY]: ..." />
                            <button onClick={() => setShowMemoryModal(false)} className="w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold transition-colors">Close Notebook</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showSettingsModal} onClose={() => apiKey && setShowSettingsModal(false)} title="System Settings">
                        <div className="space-y-6">
                            <div className="bg-gray-900/50 p-4 rounded-xl border border-white/5"><label className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2 block">Gemini API Key</label><input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-lg p-3 text-white focus:border-aura-500 outline-none transition-colors" placeholder="Paste your key here..." /></div>
                            <div className="border-t border-white/5 pt-4">
                                <div className="flex items-center justify-between mb-2"><label className="text-xs font-bold text-gray-500 uppercase tracking-widest">Memory System</label><button onClick={() => setShowMemoryHelp(!showMemoryHelp)} className="text-aura-400 hover:text-white transition-colors"><Icon icon={Icons.Info} size={16} /></button></div>
                                {showMemoryHelp && (<div className="bg-blue-900/20 p-3 rounded-lg border border-blue-500/20 text-xs text-blue-200 leading-relaxed mb-3 animate-fade-in"><strong>How Memory Works:</strong><br/> The "Aura Notebook" allows you to store persistent instructions sent to the AI every turn.</div>)}
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2 block">Data Privacy</label>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">{['local', 'session'].map(mode => (<button key={mode} onClick={() => setStorageMode(mode)} className={`p-3 rounded-xl border text-xs font-bold uppercase tracking-wider transition-all ${storageMode === mode ? 'bg-aura-600/20 border-aura-500 text-aura-300' : 'border-white/5 bg-white/5 text-gray-400 hover:bg-white/10'}`}>{mode === 'local' ? 'Local' : 'Session'}</button>))}</div>
                            </div>
                            {devMode && (
                                <div className="animate-fade-in bg-aura-900/10 p-4 rounded-xl border border-aura-500/20 space-y-4">
                                    <div className="flex items-center gap-2 text-aura-400 mb-2"><Icon icon={Icons.Wrench} size={14} /><span className="text-xs font-bold uppercase tracking-wider">Developer Config</span></div>
                                    <div><label className="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-1 block">System Prompt</label><textarea value={systemPrompt} onChange={e => setSystemPrompt(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-lg p-2 text-xs text-gray-300 h-20 resize-none outline-none focus:border-aura-500 font-mono"></textarea></div>
                                </div>
                            )}
                            <button onClick={() => setShowSettingsModal(false)} className="w-full py-3.5 bg-white text-black hover:bg-gray-200 rounded-xl font-bold transition-colors">Save Changes</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showPasskeyModal} onClose={() => setShowPasskeyModal(false)} title="Developer Access">
                         <div className="space-y-4"><p className="text-sm text-gray-400">Enter the passkey to unlock Developer Mode.</p><input type="password" value={passkeyInput} onChange={(e) => setPasskeyInput(e.target.value)} className="w-full bg-gray-900/50 border border-white/10 rounded-lg p-3 text-white focus:border-aura-500 outline-none" placeholder="Passkey" onKeyDown={(e) => e.key === 'Enter' && submitPasskey()} /><button onClick={submitPasskey} className="w-full py-3 bg-aura-600 hover:bg-aura-500 text-white rounded-xl font-bold transition-colors">Unlock</button></div>
                    </Modal>

                    {imageModalSrc && (<div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/95 backdrop-blur-xl p-4 animate-fade-in" onClick={() => setImageModalSrc(null)}><img src={imageModalSrc} alt="Full view" className="max-w-[90vw] max-h-[85vh] rounded-xl shadow-2xl object-contain cursor-zoom-out" /><div className="absolute bottom-6 flex gap-4"><a href={imageModalSrc} download="aura-image.png" className="px-6 py-2 bg-white text-black rounded-full font-bold shadow-lg hover:bg-gray-200 transition-colors" onClick={e => e.stopPropagation()}>Download</a><button className="px-6 py-2 bg-gray-800 text-white rounded-full font-bold shadow-lg hover:bg-gray-700 transition-colors border border-white/10" onClick={() => setImageModalSrc(null)}>Close</button></div></div>)}
                    {fileContentModal && (<Modal isOpen={!!fileContentModal} onClose={() => setFileContentModal(null)} title={fileContentModal.name}><pre className="text-xs text-gray-300 font-mono whitespace-pre-wrap break-all bg-black/20 p-4 rounded-lg border border-white/5">{fileContentModal.content}</pre></Modal>)}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
